name: build bundle ⚙️

on:
  push:
    branches:
    - main
    paths:
    - 'topic-hierarchy/**.csv'
  pull_request:
    branches:
    - main

jobs:
  main:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-python@v2
      name: Setup Python ${{ matrix.python-version }}
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install requirements 📦
      run: |
    - name: Create resources bundle 📦
      run: scripts/generate-bundle.py
    - uses: actions/checkout@v3
      with:
        ref: gh-pages
    - name: update gh-pages branch and publish
      run: | 
        zip -j /tmp/all.json.zip topic-hierarchy/*.csv
        mv /tmp/all.json.zip .
        git config --global user.email "tomkralidis@gmail.com"
        git config --global user.name "Tom Kralidis"
        git commit -m "generate bundle" all.json.zip
        git push -f origin main
